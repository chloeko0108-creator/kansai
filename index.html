<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>柔和莫蘭迪 - 關西8日遊</title>
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', Arial, 'PingFang TC', sans-serif;
            margin: 0;
            padding: 0;
            color: #4a4a4a; 
            background-color: #fdfafb;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- CSS 設定 --- */
        .bg-image {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=1920&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            z-index: -2;
        }
        
        .bg-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(3px);
            -webkit-backdrop-filter: blur(3px);
            z-index: -1;
        }

        /* 卡片透明度 */
        .glass-card {
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px rgba(120, 194, 196, 0.15); 
        }
        
        /* 導覽列透明度 */
        .glass-nav {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: saturate(200%) blur(24px);
            -webkit-backdrop-filter: saturate(200%) blur(24px);
            border-top: 1px solid rgba(255, 255, 255, 0.7);
            box-shadow: 0 -4px 30px rgba(120, 194, 196, 0.1);
        }
        
        /* 內部小區塊透明度 */
        .glass-inner {
            background: rgba(255, 255, 255, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .compact-card:active { transform: scale(0.97); }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* 行程頁面動態主題 CSS 變數 */
        .timeline-line { border-color: var(--theme-border); }
        .timeline-dot {
            border-color: var(--theme-border);
            color: var(--theme-text);
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            transition: all 0.3s ease;
        }
        .group:hover .timeline-dot {
            background-color: var(--theme-main);
            border-color: var(--theme-main);
            color: var(--theme-btn-text);
            transform: scale(1.1);
        }
        
        /* 展開動畫效果 */
        .collapse-content {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.3s ease-in-out;
        }
        .collapse-content.open {
            grid-template-rows: 1fr;
        }
        .collapse-inner {
            overflow: hidden;
        }
        
        /* iPhone Safe Area */
        .pb-safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        
        /* 動畫 */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="bg-image"></div>
    <div class="bg-overlay"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 1. 資料設定 ---
        const COLORS = {
            main:   { hex: '#78C2C4', light: 'rgba(120, 194, 196, 0.25)', border: 'rgba(120, 194, 196, 0.6)', text: '#458b8d', btnText: '#FFFFFF' },
            pink:   { hex: '#FEDFE1', light: 'rgba(254, 223, 225, 0.6)',  border: 'rgba(254, 223, 225, 0.9)', text: '#d16b7a', btnText: '#9e4655' },
            yellow: { hex: '#FAD689', light: 'rgba(250, 214, 137, 0.25)', border: 'rgba(250, 214, 137, 0.7)', text: '#c79822', btnText: '#8a6408' },
            green:  { hex: '#A8D8B9', light: 'rgba(168, 216, 185, 0.25)', border: 'rgba(168, 216, 185, 0.6)', text: '#64a17d', btnText: '#3b6e51' }
        };

        const REGION_COLORS = {
            '神戶': COLORS.main,
            '大阪': COLORS.pink,
            '奈良': COLORS.yellow,
            '和歌山': COLORS.green
        };

        const DAY_REGION_MAP = {
            1: '神戶', 2: '神戶', 3: '神戶', 
            4: '大阪', 5: '大阪',           
            6: '奈良',                    
            7: '和歌山', 8: '和歌山'         
        };

        const HOTELS = [
            { name: "神戶美利堅公園東方大酒店", engName: "Kobe Meriken Park Oriental Hotel", address: "神戶市中央區波止場町5-6", checkIn: "02/16(一)", checkOut: "02/18(三)", nights: 2, roomType: "東景標準大床房", tag: "神戶港夜景", icon: "ship", color: COLORS.main },
            { name: "月光園遊月山莊", engName: "Gekkoen Yuugetsu Sanso", address: "神戶市北區有馬町318", checkIn: "02/18(三)", checkOut: "02/19(四)", nights: 1, roomType: "日式房 (帶露天風呂, 禁煙)", tag: "一泊二食", icon: "hot-tub-person", color: COLORS.yellow }, 
            { name: "東急stay大阪本町酒店", engName: "Tokyu Stay Osaka Hommachi", address: "大阪市中央區久太郎町 2-4-24", checkIn: "02/19(四)", checkOut: "02/22(日)", nights: 3, roomType: "經濟型雙人床房 (帶洗衣機)", tag: "交通便利", icon: "city", color: COLORS.pink },
            { name: "和歌山大和ROYNET酒店", engName: "Daiwa Roynet Hotel Wakayama", address: "和歌山市七番丁 26-1", checkIn: "02/22(日)", checkOut: "02/23(一)", nights: 1, roomType: "標準雙床房 (禁煙)", tag: "和歌山城旁", icon: "landmark", color: COLORS.green }
        ];

        // RESTAURANTS data updated with closed days
        const RESTAURANTS = [
            { id: 10, name: "燃えよ麺助", region: "大阪", rating: 4.5, type: "拉麵", desc: "必吃紀州鴨そば！微甜醬油湯底配上二度燒蔥，香氣逼人。", icon: "bowl-rice", address: "大阪市福島區福島5-12-21", hours: "11:00-15:00, 18:00-21:00", closed: "週二" },
            { id: 11, name: "鶴屋 (Tsuruya)", region: "大阪", rating: 4.4, type: "壽喜燒", desc: "主打國產和牛，一人一鍋形式，自在享用頂級鍋物。", icon: "fire", address: "大阪市中央區日本橋1-5-4", hours: "11:00-23:00", closed: "不定休" },
            { id: 12, name: "大阪・はり重 (Hari Ju)", region: "大阪", rating: 4.5, type: "壽喜燒", desc: "百年歷史名店，嚴選雌黑毛和牛與秘製醬汁，道頓堀本店。", icon: "utensils", address: "大阪市中央区道頓堀1-9-17", hours: "11:30-22:30", closed: "週二" },
            { id: 13, name: "MORITA屋 (Moritaya)", region: "大阪", rating: 4.4, type: "壽喜燒", desc: "京都老鋪分店，擁有自家牧場高品質牛肉供應鏈，LUCUA店可賞夜景。", icon: "cow", address: "大阪市北區梅田3-1-3 LUCUA 10F", hours: "11:00-23:00", closed: "不定休" },
            { id: 15, name: "相生芳 Aioifuku", region: "大阪", rating: 4.6, type: "懷石料理", desc: "隱身於水都大阪繁華市區中的百年料亭，擁有開闊精緻的大名庭園。", icon: "house-chimney", address: "大阪市中央區高麗橋", hours: "11:30-15:00, 17:00-22:00", closed: "週日" },
            { id: 3, name: "割烹 岩木", region: "大阪", rating: 4.7, type: "懷石料理", desc: "北新地米其林一星，使用頂級天然海鮮，性價比極高。", icon: "fish", address: "大阪市北區堂島1-5-35", hours: "18:00-23:00", closed: "週日" },
            { id: 4, name: "燒肉 忍鬨 (Ninkiyo)", region: "大阪", rating: 4.8, type: "燒肉", desc: "必點厚切蔥鹽牛舌！大阪人氣爆棚的排隊燒肉店。", icon: "fire", address: "大阪市中央區東心斎橋1-6-32", hours: "17:00-01:00", closed: "不定休" },
            { id: 5, name: "人類みな麺類", region: "大阪", rating: 4.4, type: "拉麵", desc: "大阪排名第一的醬油拉麵，叉燒厚實軟嫩，湯頭甘甜。", icon: "bowl-food", address: "大阪市淀川區西中島1-12-15", hours: "10:00-03:00", closed: "無" },
            { id: 16, name: "菊水樓 Kikusuiro", region: "奈良", rating: 4.6, type: "懷石料理", desc: "位於奈良公園入口，接待過日本皇室，融合寺廟雄偉與庭園細膩。", icon: "leaf", address: "奈良市高畑町1130", hours: "11:00-15:00, 17:00-21:00", closed: "週二" },
            { id: 6, name: "まぐろ小屋", region: "奈良", rating: 4.5, type: "鮪魚丼", desc: "專賣鮪魚料理的小店，中腹肉丼飯油脂豐富，老饕必訪。", icon: "fish-fins", address: "奈良市花芝町6", hours: "11:00-16:00 (售完即止)", closed: "週日" },
            { id: 7, name: "玄 (Gen)", region: "奈良", rating: 4.6, type: "蕎麥麵", desc: "米其林推薦的蕎麥麵名店，百分之百純蕎麥製作，需預約。", icon: "wheat-awn", address: "奈良市福智院町23-2", hours: "11:30-13:30", closed: "週一" },
            { id: 17, name: "Hotel de Yoshino", region: "和歌山", rating: 4.7, type: "頂級法餐", desc: "位於和歌山市中心高層，平視古城天守閣，由日本法餐界傳奇主廚坐鎮。", icon: "wine-glass", address: "和歌山市手平2-1-2 Big-Ai 12F", hours: "11:30-14:00, 17:30-21:00", closed: "週三" },
            { id: 8, name: "井出商店", region: "和歌山", rating: 4.1, type: "拉麵", desc: "和歌山拉麵代名詞，濃郁豚骨醬油湯頭，全日本票選冠軍。", icon: "bowl-rice", address: "和歌山市田中町4-84", hours: "11:30-23:30", closed: "週四" },
            { id: 9, name: "Villa Aida", region: "和歌山", rating: 4.6, type: "義法料理", desc: "坐落田園間的傳奇餐廳，使用自家種植蔬菜，號稱日本第一農家餐廳。", icon: "carrot", address: "和歌山縣岩出市川尻71-5", hours: "12:30/18:00 (預約制)", closed: "不定休" }
        ];

        const FLIGHTS = {
            outbound: { title: "去程", date: "02/16 (一)", airline: "樂桃航空 Peach", flightNo: "MM064", dep: { time: "12:30", port: "HKG", term: "T1", city: "香港" }, arr: { time: "17:10", port: "KIX", term: "T2", city: "大阪(關西)" }, duration: "3h 40m", color: COLORS.main },
            inbound: { title: "回程", date: "02/23 (一)", airline: "樂桃航空 Peach", flightNo: "MM069", dep: { time: "23:00", port: "KIX", term: "T2", city: "大阪(關西)" }, arr: { time: "02:00", port: "HKG", term: "T1", city: "香港 (+1天)" }, duration: "4h 00m", color: COLORS.pink }
        };

        const ITINERARY = [
            { 
                day: 1, date: "02/16(一)", title: "神戶到著", weather: "8°C", weatherIcon: "cloud-sun", 
                timeline: [
                    { type: 'activity', time: '17:10', title: '抵達關西機場 T2', icon: 'plane', detail: '準備前往神戶市區' },
                    { type: 'transport', time: '約 70 分鐘', title: '關西機場 ➔ 神戶市區', icon: 'train', isLong: true, routes: ["方案 A (JR)：搭乘關空快速 ➔ 大阪站 ➔ 轉乘 JR 神戶線至三宮站", "方案 B (高速船)：搭乘 Bay Shuttle 海上高速船 (30 分) 抵達神戶機場 ➔ 轉乘捷運至市區"] },
                    { type: 'hotel', time: '19:30', title: '飯店 Check-in', icon: 'bed', detail: '神戶美利堅公園東方大酒店' },
                    { type: 'activity', time: '20:30', title: '神戶港灣夜跑', icon: 'person-running', detail: '體驗：沿著美利堅公園至臨海樂園，享受 5-10km 的浪漫海風夜跑' },
                    { type: 'transport', time: '10 分鐘', title: '返回飯店', icon: 'person-walking', routes: ["沿著港灣散步，返回美利堅公園東方大飯店休息"] }
                ]
            },
            { 
                day: 2, date: "02/17(二)", title: "神戶文創＆浪漫夜景", weather: "10°C", weatherIcon: "sun",
                timeline: [
                    { type: 'transport', time: '約 35 分鐘', title: '前往美術館', icon: 'bus', routes: ["神戶美利堅公園東方酒店 步行約 17 分鐘 ➔ 元町站 (Motomachi)", "搭乘阪神本線 (普通大阪梅田行) 6 分鐘 ➔ 岩屋站 (Iwaya)", "步行約 8 分鐘 ➔ 兵庫縣立美術館"] },
                    { type: 'activity', time: '10:00', title: '兵庫縣立美術館', icon: 'palette', detail: '安藤忠雄操刀設計，欣賞極簡清水模建築與海景，與巨大「青蘋果」合影' },
                    { type: 'transport', time: '15 分鐘', title: '阪神本線', icon: 'train-tram', routes: ["岩屋站 ➔ 元町站", "出站後步行至舊居留地"] },
                    { type: 'food', time: '12:30', title: '舊居留地午餐', icon: 'utensils', detail: '感受歐風歷史建築群與質感咖啡廳' },
                    { type: 'transport', time: '5 分鐘', title: '步行', icon: 'person-walking', routes: ["沿著三宮市區周邊散步即可抵達"] },
                    { type: 'shop', time: '14:30', title: '榮町通散策', icon: 'pen-nib', detail: '尋寶：隱藏在舊大樓裡的獨立文具店、藝術質感小物與家飾' },
                    { type: 'transport', time: '15 分鐘', title: '步行', icon: 'person-walking', routes: ["前往北長狹通，準備享用晚餐"] },
                    { 
                        type: 'food', time: '17:00', title: '神戶牛排 Ishida. 本店', icon: 'fire-burner', 
                        reservation: {
                            plan: "＜晚餐＞【網路預約限定優質雙人套餐】18,000日圓（含稅20,790日圓）※2位的價格（其他折扣不可併用）",
                            number: "預約號：AU9K3QQFFW",
                            contact: "Chloe Ko",
                            phone: "+85260304198",
                            email: "chloeko0108@gmail.com"
                        }
                    },
                    { type: 'transport', time: '40 分鐘', title: '市區巴士 & 纜車', icon: 'bus', isLong: true, routes: ["三宮站搭乘 18 系統巴士至摩耶纜車站", "轉乘摩耶纜車與索道上山"] },
                    { type: 'activity', time: '19:00', title: '摩耶山掬星台', icon: 'star', detail: '特別景點：日本三大夜景，極度浪漫' },
                    { type: 'transport', time: '45 分鐘', title: '返回飯店', icon: 'bus', isLong: true, routes: ["搭乘纜車下山後，轉乘 18 系統巴士返回三宮", "步行或轉乘電車返回神戶港灣飯店"] }
                ]
            },
            { 
                day: 3, date: "02/18(三)", title: "遊月山莊溫泉夜", weather: "7°C", weatherIcon: "cloud", 
                timeline: [
                    { type: 'hotel', time: '10:00', title: 'Check-out', icon: 'bed', detail: '準備前往有馬溫泉' },
                    { type: 'transport', time: '約 60 分鐘', title: '飯店 ➔ 三宮 ➔ 有馬溫泉', icon: 'train-subway', isLong: true, routes: ["飯店接駁/步行 ➔ 三宮站", "神戶市營地下鐵 (三宮站) ➔ 谷上站 (免出站轉乘神戶電鐵) ➔ 有馬口站 ➔ 有馬溫泉站"] },
                    { type: 'transport', time: '11:30', title: '抵達有馬溫泉', icon: 'map', detail: '溫泉街老舖巡禮、品嚐炭酸煎餅' },
                    { type: 'transport', time: '5 分鐘', title: '步行 / 旅館接駁', icon: 'van-shuttle', routes: ["沿著溫泉街漫步至旅館，或聯繫旅館專車接駁"] },
                    { type: 'hotel', time: '15:00', title: '月光園遊月山莊 Check-in', icon: 'bed', detail: '享受房內專屬露天風呂，寫意放鬆' },
                    { type: 'food', time: '18:00', title: '懷石料理晚餐', icon: 'utensils', detail: '旅館內享用傳統職人料理' }
                ]
            },
            { 
                day: 4, date: "02/19(四)", title: "大阪中崎町＆天王寺", weather: "9°C", weatherIcon: "cloud-sun", 
                timeline: [
                    { type: 'transport', time: '約 10 分鐘', title: '前往車站/巴士站', icon: 'person-walking', routes: ["步行前往有馬溫泉巴士站或神戶電鐵有馬溫泉站"] },
                    { type: 'hotel', time: '11:00', title: 'Check-out / 離開有馬溫泉', icon: 'bus', detail: '結束溫泉之旅，前往大阪' },
                    { type: 'transport', time: '約 75-85 分鐘', title: '有馬溫泉 ➔ 大阪市區', icon: 'bus', isLong: true, routes: ["方案A：搭乘直達高速巴士至大阪梅田/難波 (推薦帶行李者)", "方案B：神戶電鐵轉乘神戶市營地下鐵至三宮，再轉乘 JR/阪急至大阪"] },
                    { type: 'hotel', time: '13:00', title: '東急stay大阪本町酒店 Check-in', icon: 'bed', detail: '寄放行李' },
                    { type: 'transport', time: '15 分鐘', title: '地下鐵御堂筋線', icon: 'train-subway', routes: ["本町站 ➔ 梅田站", "出站步行約 10 分鐘至中崎町"] },
                    { type: 'activity', time: '14:00', title: '中崎町散策與調香體驗', icon: 'spa', detail: '體驗：探訪復古巷弄，在香氛工坊調製專屬兩人的紀念香水或線香' },
                    { type: 'transport', time: '20 分鐘', title: '地下鐵御堂筋線', icon: 'train-subway', isLong: true, routes: ["中崎町/梅田站 ➔ 天王寺站", "出站後步行至 Q's Mall"] },
                    { type: 'shop', time: '16:00', title: 'Sports Depo 天王寺店', icon: 'shirt', detail: '位於 Q\'s Mall，商品齊全的運動用品專賣店' },
                    { type: 'activity', time: '18:30', title: '阿倍野 HARUKAS 300 展望台', icon: 'building', detail: '特別景點：取代 TeamLab，俯瞰大阪絕美夜景' },
                    { type: 'transport', time: '10 分鐘', title: '返回飯店', icon: 'train-subway', isLong: true, routes: ["天王寺站 ➔ 本町站 (地下鐵御堂筋線)", "出站後步行返回本町飯店"] }
                ]
            },
            { 
                day: 5, date: "02/20(五)", title: "大阪中之島閒遊", weather: "11°C", weatherIcon: "sun",
                timeline: [
                    { type: 'transport', time: '約 25 分鐘', title: '前往中之島', icon: 'train-subway', routes: ["東急STAY大阪本町 步行約 5 分鐘 ➔ 本町站", "搭乘四橋線 (普通西梅田行) ➔ 肥後橋站", "步行約 13 分鐘 ➔ 中之島"] }, 
                    { type: 'activity', time: '10:00', title: '中之島散步', icon: 'water', detail: '美術館、童書森林與紅磚公會堂，寫意早晨' },
                    { type: 'transport', time: '15 分鐘', title: '地下鐵四橋線', icon: 'train-subway', routes: ["肥後橋站 ➔ 四橋站", "出站後即可抵達南堀江區域"] },
                    { type: 'shop', time: '13:30', title: '南堀江', icon: 'tent', detail: '逛街：匯集 Patagonia 等戶外山系服飾、潮流運動配件與設計家品' },
                    { type: 'transport', time: '15 分鐘', title: '地下鐵四橋線', icon: 'train-subway', routes: ["四橋站 ➔ 西梅田站", "步行前往梅田商圈各大型商場"] },
                    { type: 'shop', time: '15:30', title: '梅田商圈', icon: 'bag-shopping', detail: '集中採購：前往大型店舖尋找豐富的美術用品與運動裝備' },
                    { type: 'transport', time: '10 分鐘', title: '步行', icon: 'person-walking', routes: ["穿越梅田地下街，前往藍天大廈"] },
                    { type: 'activity', time: '18:00', title: '梅田藍天大廈', icon: 'sun', detail: '空中庭園展望台看夕陽漸層至夜景' },
                    { type: 'transport', time: '15 分鐘', title: '返回飯店', icon: 'train-subway', routes: ["梅田站 ➔ 本町站 (地下鐵御堂筋線)", "步行返回本町飯店，整理今日戰利品"] }
                ]
            },
            { 
                day: 6, date: "02/21(六)", title: "奈良小鹿與菓子", weather: "12°C", weatherIcon: "sun",
                timeline: [
                    { type: 'activity', time: '09:00', title: '前往奈良', icon: 'train', detail: '從大阪出發，準備前往奈良古都' },
                    { type: 'transport', time: '約 55 分鐘', title: '飯店 ➔ 難波 ➔ 奈良', icon: 'train', isLong: true, routes: ["住處 ➔ 本町站 (步行 5 分鐘)", "地下鐵御堂筋線：本町站 ➔ 難波站", "近鐵難波線/奈良線 ➔ 近鐵奈良站"] },
                    { type: 'activity', time: '10:00', title: '東大寺與奈良公園', icon: 'paw', detail: '世界遺產大佛殿巡禮、晨間與小鹿互動' },
                    { type: 'transport', time: '10 分鐘', title: '步行', icon: 'person-walking', routes: ["穿越奈良公園，緩步上坡即可抵達若草山"] },
                    { type: 'activity', time: '13:30', title: '若草山絕景行山', icon: 'person-hiking', detail: '體驗：漫步登上開闊的草地山坡，與小鹿相伴，俯瞰奈良古都全景' },
                    { type: 'transport', time: '15 分鐘', title: '步行', icon: 'person-walking', routes: ["下山往近鐵奈良站方向，進入市區老街"] },
                    { type: 'shop', time: '15:30', title: '鹿猿狐包袱小路', icon: 'gift', detail: '中川政七旗艦店：日本工藝生活家品' },
                    { type: 'transport', time: '10 分鐘', title: '步行', icon: 'person-walking', routes: ["沿著町家老街步行至茶道體驗處"] },
                    { type: 'activity', time: '17:00', title: '奈良町茶道與和菓子', icon: 'bowl-food', detail: '體驗：在百年町家內參與傳統茶道，親手製作和菓子' },
                    { type: 'transport', time: '約 40 分鐘', title: '奈良 ➔ 大阪難波', icon: 'train', isLong: true, routes: ["近鐵奈良站 ➔ 大阪難波站"] },
                    { type: 'transport', time: '10 分鐘', title: '難波 ➔ 梅田 (Step Sport)', icon: 'train-subway', routes: ["轉乘地下鐵御堂筋線：難波站 ➔ 梅田站"] },
                    { type: 'shop', time: '19:00', title: 'SteP SPORTS Run City Osaka', icon: 'shoe-prints', detail: '跑者聖地，專業慢跑鞋與裝備挑選 (茶屋町店)' },
                    { type: 'transport', time: '15 分鐘', title: '返回飯店', icon: 'train-subway', routes: ["梅田站 ➔ 本町站", "步行返回本町飯店休息"] }
                ]
            },
            { 
                day: 7, date: "02/22(日)", title: "和歌山聖地奧之院", weather: "13°C", weatherIcon: "cloud-sun", 
                timeline: [
                    { type: 'hotel', time: '09:30', title: 'Check-out', icon: 'bed', detail: '離開大阪，前往和歌山' },
                    { type: 'transport', time: '約 90 分鐘', title: '大阪市區 ➔ 和歌山', icon: 'train', isLong: true, routes: ["住處 ➔ 本町站 (步行 5 分鐘)", "地下鐵御堂筋線：本町站 ➔ 難波站/天王寺站", "南海特急南方號/JR特急黑潮號 ➔ 和歌山站/和歌山市站"] },
                    { type: 'hotel', time: '11:00', title: '飯店寄放行李', icon: 'bed', detail: '和歌山大和ROYNET酒店' },
                    { type: 'transport', time: '約 120 分鐘', title: '前往高野山', icon: 'car', isLong: true, routes: ["建議包車或租車前往，大眾運輸需經和歌山站轉乘南海電鐵"] },
                    { type: 'activity', time: '14:30', title: '高野山 奧之院', icon: 'torii-gate', detail: '日本佛教聖地，漫步於千年杉木林參道，感受莊嚴肅穆的氛圍' },
                    { type: 'transport', time: '約 90 分鐘', title: '返回和歌山市區', icon: 'car', isLong: true, routes: ["下山返回和歌山市區，前往和歌山城"] },
                    { type: 'activity', time: '16:30', title: '和歌山城散步', icon: 'landmark', detail: '夕陽下的名城庭園與天守閣，寫意浪漫' },
                    { type: 'transport', time: '10 分鐘', title: '步行 / 巴士', icon: 'bus', routes: ["前往井出商店"] },
                    { type: 'food', time: '18:30', title: '井出商店', icon: 'utensils', detail: '晚餐：品嚐全日本知名的正宗和歌山拉麵' },
                    { type: 'transport', time: '10 分鐘', title: '返回飯店', icon: 'person-walking', routes: ["散步返回和歌山大和ROYNET酒店休息"] }
                ]
            },
            { 
                day: 8, date: "02/23(一)", title: "回家摸喵喵", weather: "14°C", weatherIcon: "sun", 
                timeline: [
                    { type: 'hotel', time: '09:00', title: 'Check-out', icon: 'bed', detail: '' },
                    { type: 'transport', time: '約 10 分鐘', title: '前往和歌山站', icon: 'person-walking', routes: ["住處 (Daiwa Roynet) ➔ JR 和歌山站 (步行約 10-15 分鐘或搭乘巴士)"] },
                    { type: 'transport', time: '約 40 分鐘', title: '飯店 ➔ 貴志站', icon: 'train-tram', isLong: true, routes: ["和歌山電鐵 ➔ 貴志站 (探訪貓咪站長)"] },
                    { type: 'activity', time: '10:00', title: '和歌山電鐵貴志川線', icon: 'train-tram', detail: '搭乘特色列車探訪超萌「二代玉」貓咪站長' },
                    { type: 'transport', time: '40 分鐘', title: '和歌山巴士', icon: 'bus', isLong: true, routes: ["返回和歌山站，轉乘巴士前往雜賀崎漁港"] },
                    { type: 'activity', time: '13:30', title: '雜賀崎漁港', icon: 'camera', detail: '有「日本阿瑪菲」之稱的浪漫復古海岸' },
                    { type: 'transport', time: '5 分鐘', title: '步行', icon: 'person-walking', routes: ["沿著海岸線前往海景咖啡廳"] },
                    { type: 'cafe', time: '15:00', title: '海邊絕景咖啡廳', icon: 'mug-hot', detail: '享受旅行最後的看海放空時光' },
                    { type: 'transport', time: '約 50 分鐘', title: '和歌山 ➔ 臨空城', icon: 'train', isLong: true, routes: ["搭乘巴士返回和歌山市區", "轉乘南海電鐵或 JR 前往臨空城 (Rinku Town)"] },
                    { type: 'shop', time: '16:30', title: '臨空城 Outlet', icon: 'bag-shopping', detail: '最後血拼：集中掃貨各大運動品牌的跑步、網球鞋與服飾' },
                    { type: 'transport', time: '10 分鐘', title: '鐵路 (機場線)', icon: 'train', routes: ["臨空城站 ➔ 關西機場站"] },
                    { type: 'activity', time: '20:30', title: '抵達關西機場', icon: 'plane-departure', detail: '辦理報到、免稅店最後採購物產與伴手禮' },
                    { type: 'transport', time: '23:00', title: '搭乘 MM069 航班', icon: 'plane', detail: '帶著滿滿回憶返回，於 02/24 凌晨抵達' }
                ]
            }
        ];

        // SAVED_SPOTS updated with hours, closed days and new shops
        const SAVED_SPOTS = [
            { id: 1, name: "榮町通 Sakaemachi", category: "Shop", icon: "pen-nib", region: "神戶", tags: ["文具", "選物"], note: "隱藏舊大樓的特色小店", day: "Day 2", address: "神戶市中央區榮町通", hours: "11:00-19:00", closed: "不定休" },
            { id: 2, name: "TeamLab Botanical Garden", category: "Sight", icon: "lightbulb", region: "大阪", tags: ["夜間光影", "浪漫"], note: "植物園內的沉浸式夢幻藝術", day: "Day 4", address: "大阪市東住吉區長居植物園", hours: "18:00-21:30", closed: "每月第2,4週一" },
            { id: 3, name: "南堀江 Orange Street", category: "Shop", icon: "tent", region: "大阪", tags: ["山系服飾", "家品"], note: "網羅戶外品牌與質感傢俱", day: "Day 5", address: "大阪市西區南堀江", hours: "11:00-20:00", closed: "無" },
            { id: 4, name: "梅田 LOFT", category: "Shop", icon: "paintbrush", region: "大阪", tags: ["美術"], note: "一站買齊所有繪畫與設計工具", day: "Day 5", address: "大阪市北區茶屋町", hours: "11:00-21:00", closed: "無" },
            { id: 10, name: "臨空城 Outlets", category: "Shop", icon: "shoe-prints", region: "大阪", tags: ["血拼"], note: "登機前採購，匯集運動服飾", day: "Day 8", address: "大阪府泉佐野市", hours: "10:00-20:00", closed: "年1次 (2月)" },
            { id: 12, name: "相生芳 Aioifuku", category: "Food", icon: "house-chimney", region: "大阪", tags: ["懷石料理"], note: "隱身市區的百年料亭，展現靜謐", day: "待排程", address: "大阪市中央區高麗橋", hours: "11:30-22:00", closed: "週日" },
            { id: 5, name: "若草山行山路線", category: "Experience", icon: "person-hiking", region: "奈良", tags: ["行山"], note: "浪漫草地山坡，與鹿共賞全景", day: "Day 6", address: "奈良市雜司町", hours: "全天開放", closed: "無" },
            { id: 6, name: "中川政七商店", category: "Shop", icon: "gift", region: "奈良", tags: ["家品"], note: "絕美複合空間，生活道具必逛", day: "Day 6", address: "奈良市元林院町", hours: "10:00-19:00", closed: "無" },
            { id: 13, name: "菊水樓 Kikusuiro", category: "Food", icon: "leaf", region: "奈良", tags: ["歷史建築"], note: "接待皇室名門，挑高落地窗直面綠意", day: "待排程", address: "奈良市高畑町", hours: "11:00-21:00", closed: "週二" },
            { id: 15, name: "高野山 奧之院", category: "Experience", icon: "torii-gate", region: "和歌山", tags: ["世界遺產", "朝聖"], note: "日本佛教聖地，漫步於參道杉木林", day: "Day 7", address: "和歌山縣伊都郡", hours: "全天開放", closed: "無" },
            { id: 7, name: "紀州漆器 蒔繪", category: "Experience", icon: "paintbrush", region: "和歌山", tags: ["手作"], note: "體驗優雅的金粉彩繪工藝", day: "Day 7", address: "和歌山縣", hours: "09:00-17:00", closed: "週三" },
            { id: 8, name: "和歌山城", category: "Sight", icon: "landmark", region: "和歌山", tags: ["歷史"], note: "日本百大名城，夕陽時分散步", day: "Day 7", address: "和歌山市一番丁", hours: "09:00-17:30", closed: "12/29-31" },
            { id: 9, name: "雜賀崎漁港", category: "Sight", icon: "camera", region: "和歌山", tags: ["海景"], note: "日本阿瑪菲，依山傍海的漁村", day: "Day 8", address: "和歌山市雜賀崎", hours: "全天開放", closed: "無" },
            { id: 14, name: "Hotel de Yoshino", category: "Food", icon: "wine-glass", region: "和歌山", tags: ["頂級法餐"], note: "平視和歌山城天守閣，傳奇主廚坐鎮", day: "待排程", address: "和歌山市手平", hours: "11:30-21:00", closed: "週三" },
            { id: 18, name: "Sports Depo 天王寺店", category: "Shop", icon: "shirt", region: "大阪", tags: ["運動", "購物"], note: "商品齊全的運動用品專賣店", day: "Day 4", address: "大阪市阿倍野區 Q's Mall", hours: "10:00-22:00", closed: "無" },
            { id: 19, name: "SteP SPORTS Run City Osaka", category: "Shop", icon: "shoe-prints", region: "大阪", tags: ["跑鞋", "專業"], note: "跑者聖地，專業慢跑鞋與裝備挑選", day: "Day 6", address: "大阪市北區茶屋町", hours: "11:00-20:00", closed: "無" }
        ];

        // --- 2. 元件定義 ---
        
        // TimelineItemCard (保持不變)
        const TimelineItemCard = ({ item, theme }) => {
            const [isOpen, setIsOpen] = useState(false);
            const hasRes = !!item.reservation;
            const hasRoutes = item.routes && item.routes.length > 0;
            const isTransport = item.type === 'transport';
            const isExpandable = hasRes || hasRoutes;

            if (isTransport) {
                return (
                    <div className="relative mt-4 mb-2">
                        <div className="absolute -left-[43px] top-3.5 w-[24px] h-[24px] rounded-full flex items-center justify-center bg-[#fdfafb] border-2 z-10 transition-colors" style={{ borderColor: theme.border }}>
                            <i className={`fa-solid fa-${item.icon || 'arrow-right'} text-[10px]`} style={{ color: theme.text }}></i>
                        </div>
                        <div className="glass-inner rounded-[16px] p-2.5 cursor-pointer hover:bg-white/60 transition-colors shadow-sm" onClick={() => isExpandable && setIsOpen(!isOpen)}>
                            <div className="flex justify-between items-center px-1">
                                <div className="flex items-center gap-2">
                                    <span className={`text-[11px] font-bold px-2 py-0.5 rounded-md ${item.isLong ? 'bg-[#FEDFE1] text-[#d16b7a]' : 'bg-black/5 text-slate-500'}`}>{item.time}</span>
                                    <span className="text-[13px] font-bold text-slate-700">{item.title}</span>
                                </div>
                                {isExpandable && <i className={`fa-solid fa-chevron-down text-[10px] text-slate-400 transition-transform duration-300 ${isOpen ? 'rotate-180' : ''}`}></i>}
                            </div>
                            {isExpandable && (
                                <div className={`collapse-content ${isOpen ? 'open' : ''}`}>
                                    <div className="collapse-inner">
                                        <div className="mt-2.5 pt-2 border-t border-black/5 px-1 space-y-1.5">
                                            {item.routes && item.routes.map((route, i) => (
                                                <div key={i} className="flex gap-1.5 items-start">
                                                    <i className="fa-solid fa-turn-up rotate-90 text-[10px] mt-[3px] opacity-40" style={{ color: theme.text }}></i>
                                                    <p className="text-xs text-slate-600 font-medium leading-relaxed">{route}</p>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            return (
                <div className="relative group mt-4 mb-2">
                    <div className="absolute -left-[53px] w-10 h-10 rounded-full flex items-center justify-center shadow-sm border-[2px] timeline-dot">
                        <i className={`fa-solid fa-${item.icon} text-[15px]`}></i>
                    </div>
                    <div className={`glass-inner rounded-[24px] p-4 transition-colors group-hover:bg-white/60 ${isExpandable ? 'cursor-pointer' : ''}`} onClick={() => isExpandable && setIsOpen(!isOpen)}>
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-3 mb-1.5">
                                <span className="text-slate-600 font-bold text-sm">{item.time}</span>
                                <span className="text-slate-800 font-bold text-base">{item.title}</span>
                            </div>
                            {isExpandable && <i className={`fa-solid fa-chevron-down text-slate-400 text-xs transition-transform duration-300 ${isOpen ? 'rotate-180' : ''}`}></i>}
                        </div>
                        {item.detail && <p className="text-[15px] text-slate-600 font-medium leading-relaxed">{item.detail}</p>}
                        {hasRes && (
                            <div className={`collapse-content ${isOpen ? 'open' : ''}`}>
                                <div className="collapse-inner">
                                    <div className="mt-3 pt-3 border-t border-black/5 text-[13px] text-slate-600 space-y-1.5">
                                        <div className="font-bold text-slate-700 bg-slate-100 px-2 py-0.5 rounded w-fit mb-2">預約確認資訊</div>
                                        <p className="font-bold text-[#d16b7a]">{item.reservation.plan}</p>
                                        <p className="font-mono bg-white/50 px-2 py-1 rounded border border-slate-200 inline-block text-slate-700">{item.reservation.number}</p>
                                        <div className="space-y-0.5 text-slate-500">
                                            <p><i className="fa-regular fa-user w-4"></i> {item.reservation.contact}</p>
                                            <p><i className="fa-solid fa-phone w-4"></i> {item.reservation.phone}</p>
                                            <p><i className="fa-regular fa-envelope w-4"></i> {item.reservation.email}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // RestaurantCard (Update to show closed days)
        const RestaurantCard = ({ item }) => {
            const theme = REGION_COLORS[item.region] || COLORS.main;
            return (
                <div className="glass-card rounded-[24px] p-4 cursor-pointer transition-all hover:bg-white/60">
                    <div className="flex gap-4 items-center">
                        <div className="w-16 h-16 rounded-2xl flex items-center justify-center text-2xl flex-shrink-0 border" style={{ backgroundColor: theme.light, color: theme.text, borderColor: theme.border }}>
                            <i className={`fa-solid fa-${item.icon}`}></i>
                        </div>
                        <div className="flex-1 min-w-0">
                            <div className="flex justify-between items-center mb-1">
                                <h3 className="font-bold text-slate-800 text-lg truncate pr-2">{item.name}</h3>
                                <div className="flex items-center gap-1 bg-yellow-50 px-2 py-0.5 rounded-md border border-yellow-200 flex-shrink-0">
                                    <i className="fa-solid fa-star text-yellow-500 text-xs"></i>
                                    <span className="text-xs font-bold text-slate-700">{item.rating}</span>
                                </div>
                            </div>
                            <div className="flex items-center gap-2 mb-1.5">
                                <span className="text-[10px] px-2 py-0.5 rounded border font-bold" style={{ backgroundColor: theme.light, color: theme.text, borderColor: theme.border }}>
                                    {item.region}
                                </span>
                                <span className="text-xs text-slate-500">{item.type}</span>
                            </div>
                        </div>
                    </div>
                    <p className="mt-3 text-sm text-slate-600 line-clamp-2">{item.desc}</p>
                    <div className="mt-3 pt-3 border-t border-gray-100 flex flex-col gap-1 text-xs text-gray-400">
                        <div className="flex items-center justify-between">
                            <span><i className="fa-regular fa-clock mr-1"></i>{item.hours.split(',')[0]}</span>
                            <span className="text-red-400"><i className="fa-solid fa-ban mr-1"></i>{item.closed}</span>
                        </div>
                        <div className="flex items-center gap-1"><i className="fa-solid fa-location-dot"></i> {item.address}</div>
                    </div>
                </div>
            );
        };

        // --- 3. 主要視圖元件 ---

        // (1) 行程檢視 (保持不變)
        const ItineraryView = () => {
            const [selectedDay, setSelectedDay] = useState(1);
            const currentPlan = ITINERARY.find(d => d.day === selectedDay);
            const theme = REGION_COLORS[DAY_REGION_MAP[selectedDay]] || COLORS.main;

            return (
                <div className="pb-24 fade-in">
                    {/* 日期選擇器 */}
                    <div className="sticky top-0 z-40 bg-[#fdfafb]/90 backdrop-blur-md pt-4 pb-2 px-2 overflow-x-auto whitespace-nowrap scrollbar-hide border-b border-gray-100">
                        {ITINERARY.map((item) => {
                            const dayTheme = REGION_COLORS[DAY_REGION_MAP[item.day]] || COLORS.main;
                            const isSelected = selectedDay === item.day;
                            return (
                                <button
                                    key={item.day}
                                    onClick={() => setSelectedDay(item.day)}
                                    className={`inline-flex flex-col items-center justify-center w-16 h-16 mx-1 rounded-2xl transition-all duration-300 border ${
                                        isSelected 
                                        ? 'text-white shadow-lg scale-105' 
                                        : 'bg-white text-gray-400 border-gray-200'
                                    }`}
                                    style={isSelected ? { backgroundColor: dayTheme.hex, borderColor: dayTheme.border } : {}}
                                >
                                    <span className="text-xs font-bold leading-tight">{item.date.split('(')[0]}</span>
                                    <span className="text-xs font-light opacity-80 mb-0.5">({item.date.split('(')[1]}</span>
                                    <span className="text-[10px] font-medium opacity-70 uppercase">Day {item.day}</span>
                                </button>
                            );
                        })}
                    </div>

                    <div className="px-5 mt-6">
                        <div className="flex justify-between items-end mb-6">
                            <div>
                                <h1 className="text-2xl font-bold text-slate-800">{currentPlan.title}</h1>
                            </div>
                            <div className="text-2xl" style={{color: theme.text}}>
                                <i className={`fa-solid fa-${currentPlan.weatherIcon} mr-2`}></i>
                                <span className="text-lg font-bold">{currentPlan.weather}</span>
                            </div>
                        </div>

                        <div className="relative pl-4 border-l-2 border-dashed border-gray-200 ml-2 timeline-line" style={{'--theme-border': theme.border, '--theme-text': theme.text, '--theme-main': theme.hex, '--theme-btn-text': theme.btnText}}>
                            {currentPlan.timeline.map((item, idx) => (
                                <TimelineItemCard key={idx} item={item} theme={theme} />
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // (2) 收藏/探索檢視 (增加顯示營業時間和定休日)
        const ExploreView = () => {
            const [filter, setFilter] = useState('all');
            return (
                <div className="px-5 pt-8 pb-24 fade-in">
                    <div className="flex gap-2 mb-6 overflow-x-auto scrollbar-hide">
                        {['all:全部', 'Food:餐廳', 'Shop:購物', 'Experience:體驗'].map(f => {
                            const [key, label] = f.split(':');
                            return (
                                <button key={key} onClick={() => setFilter(key)}
                                    className={`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-colors ${filter === key ? 'bg-slate-800 text-white' : 'bg-white text-slate-500 border border-gray-200'}`}>
                                    {label}
                                </button>
                            );
                        })}
                    </div>

                    <div className="space-y-4">
                        {(filter === 'all' || filter === 'Food') && RESTAURANTS.map(r => (
                            <RestaurantCard key={`r-${r.id}`} item={r} />
                        ))}
                        
                        {SAVED_SPOTS.filter(s => s.category !== 'Food' && (filter === 'all' || filter === s.category)).map(spot => {
                            const theme = REGION_COLORS[spot.region] || COLORS.main;
                            return (
                                <div key={`s-${spot.id}`} className="glass-card p-4 rounded-2xl flex items-center gap-4">
                                    <div className="w-12 h-12 rounded-xl flex items-center justify-center border" style={{ backgroundColor: theme.light, color: theme.text, borderColor: theme.border }}>
                                        <i className={`fa-solid fa-${spot.icon}`}></i>
                                    </div>
                                    <div className="flex-1">
                                        <h4 className="font-bold text-slate-700">{spot.name}</h4>
                                        <div className="flex items-center gap-2 mt-1 mb-1">
                                            <span className="text-[10px] border px-2 py-0.5 rounded font-bold" style={{ backgroundColor: theme.light, color: theme.text, borderColor: theme.border }}>
                                                {spot.region}
                                            </span>
                                            <span className="text-[10px] border border-slate-200 text-slate-400 px-2 py-0.5 rounded">{spot.day}</span>
                                        </div>
                                        <div className="text-xs text-gray-500 space-y-1">
                                            <div className="flex items-center justify-between">
                                                <span><i className="fa-regular fa-clock mr-1 text-slate-300"></i>{spot.hours}</span>
                                                <span className="text-red-400"><i className="fa-solid fa-ban mr-1"></i>{spot.closed}</span>
                                            </div>
                                            <div className="flex items-center gap-1"><i className="fa-solid fa-location-dot text-slate-300"></i> {spot.address}</div>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // (3) 工具檢視 (保持不變)
        const ToolsView = () => {
            const [toolMode, setToolMode] = useState('notes'); // notes, rail, holiday
            
            const [notes, setNotes] = useState(() => JSON.parse(localStorage.getItem('trip_notes')) || [
                { id: 1, title: '要買的東西', content: '合利他命、Uniqlo發熱衣...' }
            ]);
            const [newNoteTitle, setNewNoteTitle] = useState('');
            const [newNoteContent, setNewNoteContent] = useState('');

            useEffect(() => localStorage.setItem('trip_notes', JSON.stringify(notes)), [notes]);

            const addNote = () => {
                if (!newNoteTitle) return;
                setNotes([...notes, { id: Date.now(), title: newNoteTitle, content: newNoteContent }]);
                setNewNoteTitle('');
                setNewNoteContent('');
            };

            const deleteNote = (id) => {
                setNotes(notes.filter(n => n.id !== id));
            };

            const themeColor = COLORS.main.hex;

            // 分類的鐵路資訊
            const RAIL_INFO = {
                cross: [
                    {name: "ICOCA / Suica", desc: "關西地區通用，搭車購物皆可", icon: "ticket"},
                    {name: "Haruka 特急", desc: "關西機場 ⇄ 京都/大阪 (需劃位)", icon: "train-subway"},
                    {name: "阪神電鐵", desc: "大阪難波 ⇄ 神戶三宮", icon: "train"},
                    {name: "近鐵電車", desc: "大阪難波 ⇄ 奈良", icon: "train-tram"},
                    {name: "南海電鐵", desc: "關西機場 ⇄ 難波 / 和歌山市", icon: "train"},
                ],
                city: [
                    {name: "大阪地下鐵", desc: "御堂筋線(紅)、四橋線(藍) 最常用", icon: "train-subway"},
                    {name: "神戶市營地鐵", desc: "三宮 ⇄ 谷上 (往有馬溫泉)", icon: "train"},
                    {name: "和歌山電鐵", desc: "貴志川線 (貓咪站長)", icon: "cat"},
                    {name: "Port Liner", desc: "神戶機場/港灣人工島線", icon: "train-tram"},
                ]
            };

            return (
                <div className="px-5 pt-8 pb-24 fade-in">
                    <div className="flex glass-inner rounded-xl p-1 mb-6">
                        {['notes:記事', 'rail:鐵路', 'holiday:祭典'].map(m => {
                            const [key, label] = m.split(':');
                            return (
                                <button key={key} onClick={() => setToolMode(key)} 
                                    className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${toolMode === key ? 'text-white shadow-md' : 'text-slate-400'}`}
                                    style={toolMode === key ? { backgroundColor: themeColor } : {}}>
                                    {label}
                                </button>
                            )
                        })}
                    </div>

                    {toolMode === 'notes' && (
                        <div className="space-y-4">
                            <div className="glass-card p-4 rounded-2xl">
                                <input value={newNoteTitle} onChange={e=>setNewNoteTitle(e.target.value)} placeholder="標題..." className="w-full bg-white/50 p-2 rounded-lg mb-2 text-sm font-bold outline-none"/>
                                <textarea value={newNoteContent} onChange={e=>setNewNoteContent(e.target.value)} placeholder="內容..." className="w-full bg-white/50 p-2 rounded-lg text-sm h-16 outline-none resize-none mb-2"></textarea>
                                <button onClick={addNote} className="w-full py-2 rounded-lg text-white font-bold text-sm shadow-md" style={{backgroundColor: themeColor}}>
                                    <i className="fa-solid fa-plus mr-1"></i> 新增記事
                                </button>
                            </div>
                            {notes.map(n => (
                                <div key={n.id} className="glass-card p-4 rounded-2xl relative">
                                    <button onClick={()=>deleteNote(n.id)} className="absolute top-3 right-3 text-slate-300 hover:text-red-400">
                                        <i className="fa-solid fa-xmark"></i>
                                    </button>
                                    <h3 className="font-bold text-slate-700 mb-1">{n.title}</h3>
                                    <p className="text-sm text-slate-500 whitespace-pre-wrap">{n.content}</p>
                                </div>
                            ))}
                        </div>
                    )}

                    {toolMode === 'rail' && (
                        <div className="space-y-6">
                            <div>
                                <h3 className="text-sm font-bold text-gray-400 mb-2 pl-1">跨地區移動</h3>
                                <div className="space-y-3">
                                    {RAIL_INFO.cross.map((r, i) => (
                                        <div key={i} className="glass-card p-4 rounded-2xl flex items-center gap-4">
                                            <div className="w-10 h-10 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center">
                                                <i className={`fa-solid fa-${r.icon}`}></i>
                                            </div>
                                            <div>
                                                <h4 className="font-bold text-slate-700">{r.name}</h4>
                                                <p className="text-xs text-gray-400">{r.desc}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                            <div>
                                <h3 className="text-sm font-bold text-gray-400 mb-2 pl-1">市內 / 短程</h3>
                                <div className="space-y-3">
                                    {RAIL_INFO.city.map((r, i) => (
                                        <div key={i} className="glass-card p-4 rounded-2xl flex items-center gap-4">
                                            <div className="w-10 h-10 rounded-full bg-green-50 text-green-500 flex items-center justify-center">
                                                <i className={`fa-solid fa-${r.icon}`}></i>
                                            </div>
                                            <div>
                                                <h4 className="font-bold text-slate-700">{r.name}</h4>
                                                <p className="text-xs text-gray-400">{r.desc}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {toolMode === 'holiday' && (
                        <div className="space-y-3">
                            <div className="glass-card p-4 rounded-2xl border-l-4 border-red-400">
                                <h4 className="font-bold text-slate-700">02/23 (一) 天皇誕生日</h4>
                                <p className="text-xs text-gray-500">日本國定假日，交通與景點人潮可能較多。</p>
                            </div>
                            <div className="glass-card p-4 rounded-2xl border-l-4 border-pink-400">
                                <h4 className="font-bold text-slate-700">梅花季</h4>
                                <p className="text-xs text-gray-500">大阪城公園、北野天滿宮梅花盛開。</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // (4) 資訊檢視 (保持不變)
        const InfoView = () => (
            <div className="px-5 pt-8 pb-24 fade-in">
                 <div className="mb-8">
                    <h3 className="text-sm font-bold text-gray-400 uppercase mb-3 ml-1">航班資訊</h3>
                    <div className="space-y-4">
                        {[FLIGHTS.outbound, FLIGHTS.inbound].map((f, i) => (
                            <div key={i} className="glass-card p-0 rounded-3xl overflow-hidden mb-4">
                                {/* Color Header */}
                                <div className="p-3 flex justify-between items-center" style={{backgroundColor: f.color.hex}}>
                                     <span className="text-white font-bold text-sm"><i className="fa-solid fa-plane mr-2"></i>{f.title}</span>
                                     <span className="text-white font-bold text-sm opacity-90">{f.date}</span>
                                </div>
                                <div className="p-5">
                                    <div className="flex justify-between items-end mb-4">
                                        <div className="text-left">
                                            <div className="text-3xl font-black text-slate-700 leading-none">{f.dep.time}</div>
                                            <div className="text-xs text-gray-400 font-bold mt-1">{f.dep.port} <span className="text-slate-600 bg-gray-200 px-1 rounded">{f.dep.term}</span></div>
                                        </div>
                                        <div className="flex-1 px-4 flex flex-col items-center pb-1">
                                            <span className="text-[10px] text-gray-400 mb-1">{f.duration}</span>
                                            <div className="w-full h-[2px] bg-gray-200 relative">
                                                <div className="absolute right-0 -top-[3px] w-2 h-2 rounded-full bg-gray-300"></div>
                                                <i className="fa-solid fa-plane absolute left-1/2 -top-[6px] -translate-x-1/2 text-gray-300 text-xs"></i>
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-3xl font-black text-slate-700 leading-none">{f.arr.time}</div>
                                            <div className="text-xs text-gray-400 font-bold mt-1">{f.arr.port} <span className="text-white px-1 rounded shadow-sm" style={{backgroundColor: f.color.text}}>{f.arr.term}</span></div>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-2 bg-gray-50 p-2 rounded-xl">
                                         <div className="w-8 h-8 rounded-full flex items-center justify-center bg-white shadow-sm text-slate-500">
                                            <i className="fa-solid fa-ticket"></i>
                                         </div>
                                         <div className="flex-1">
                                             <div className="text-xs text-gray-400">航班編號</div>
                                             <div className="text-sm font-bold text-slate-700">{f.airline} {f.flightNo}</div>
                                         </div>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                 </div>

                 <div>
                    <h3 className="text-sm font-bold text-gray-400 uppercase mb-3 ml-1">住宿安排</h3>
                    <div className="space-y-4">
                        {HOTELS.map((h, i) => (
                            <div key={i} className="glass-card p-4 rounded-2xl flex gap-4 items-start">
                                <div className="w-12 h-12 rounded-full flex items-center justify-center text-white shrink-0 shadow-md" style={{backgroundColor: h.color.hex}}>
                                    <i className={`fa-solid fa-${h.icon}`}></i>
                                </div>
                                <div>
                                    <h4 className="font-bold text-slate-700 leading-tight mb-1">{h.name}</h4>
                                    <p className="text-xs text-gray-500 mb-2">{h.checkIn.split('(')[0]} - {h.checkOut.split('(')[0]} ({h.nights}晚)</p>
                                    <span className="text-[10px] px-2 py-0.5 rounded border" style={{borderColor: h.color.text, color: h.color.text}}>
                                        {h.tag}
                                    </span>
                                </div>
                            </div>
                        ))}
                    </div>
                 </div>
            </div>
        );

        // (5) 底部導航 (保持不變)
        const BottomNav = ({ activeTab, setActiveTab }) => {
            const tabs = [
                { id: 'itinerary', icon: 'calendar-days', label: '行程' },
                { id: 'explore', icon: 'heart', label: '收藏' }, 
                { id: 'tools', icon: 'suitcase', label: '工具' },
                { id: 'info', icon: 'circle-info', label: '資訊' }
            ];

            return (
                <div className="fixed bottom-0 left-0 right-0 glass-nav pb-safe-bottom z-50 rounded-t-2xl">
                    <div className="flex justify-around items-center h-16 safe-bottom">
                        {tabs.map(tab => (
                            <button 
                                key={tab.id}
                                onClick={() => setActiveTab(tab.id)}
                                className={`flex flex-col items-center justify-center w-full h-full transition-all duration-300 ${activeTab === tab.id ? 'text-[#78C2C4] -translate-y-1' : 'text-gray-400'}`}
                            >
                                <i className={`fa-solid fa-${tab.icon} text-xl mb-1`}></i>
                                <span className="text-[10px] font-medium">{tab.label}</span>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // --- 4. 主程式 App ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('itinerary');

            return (
                <div className="max-w-md mx-auto min-h-screen relative pb-20">
                    {/* 根據 Tab 切換顯示內容 */}
                    {activeTab === 'itinerary' && <ItineraryView />}
                    {activeTab === 'explore' && <ExploreView />}
                    {activeTab === 'tools' && <ToolsView />}
                    {activeTab === 'info' && <InfoView />}

                    {/* 底部導航 */}
                    <BottomNav activeTab={activeTab} setActiveTab={setActiveTab} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
